<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container" style="margin-top: 2em">
      <div class="mb-3">
        <form id="searchForm" action="/products/search" method="get" class="form-inline my-2 my-lg-0">
            <div style="display: flex; justify-content: center;">    
                <input
                id="searchedData" 
                class="form-control mr-sm-2 mb-2 mt-2 mx-3"
                type="search"
                placeholder="Search Product"
                aria-label="Search"
                name="productSearch"
                />
                <button
                class="btn btn-outline-primary my-1 my-sm-2 mx-3"
                type="submit"
                >
                Search
                </button>
            </div>
        </form>
    </div>
    <!-- End search product input -->
    <div style="display: flex;">
        <div style="flex-grow: 1;"><h3 style="margin-bottom: 1em">Categories</h3></div>
        <div style="justify-content: flex-end;"><button class="btn btn-primary" onclick="window.location.href='/all-products'">View all Products</button></div>
        <div style="margin-left: 1em; justify-content: flex-end;"><button onclick="window.history.back()" class="btn btn-outline-primary"> Back</button></div>
    </div>
        <!-- Categories Table -->
        <table border="1" id="categories-table" class="table table-striped">
            <thead style="background-color: black; color: white">
                <tr>
                    <th scope="col">Category ID</th>
                    <th scope="col">Category Name</th>
                    <th scope="col">Stock Count</th>
                    <th scope="col">Created Date</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <!-- Pagination -->
        <div class="container">
            <nav aria-label="Page navigation example">
                <ul class="pagination" id="pagination">
                </ul>
            </nav>
        </div>
        <!-- End Pagination -->
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        try {
          const urlParams = new URLSearchParams(window.location.search);
          const page = urlParams.get('page') || 1; // Get the page number from URL, default to 1 if not provided
          const url = `/api/categories?page=${page}`; // Updated endpoint URL with page query parameter
    
          const response = await fetch(url);
          const data = await response.json();
          const categories = data.categories;
          const totalPages = data.totalPages;
          const currentPage = data.currentPage;
    
          renderCategories(categories);
          renderPagination(totalPages, currentPage);
        } catch (error) {
          console.error('Error fetching categories:', error);
        }
      });
    
      function renderCategories(categories) {
        const tbody = document.querySelector('#categories-table tbody');
        tbody.innerHTML = '';
    
        categories.forEach(category => {
          const row = `
                <tr>
                    <td>${category.cat_id}</td>
                    <td><a href="/product/${category.cat_id}">${category.cat_name}</a></td>
                    <td>${category.stock_count}</td>
                    <td>${new Date(category.created_date).toLocaleDateString()}</td>
                </tr>
            `;
          tbody.innerHTML += row;
        });
      }
    
    function renderPagination(totalPages, currentPage) {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    // Previous button
    const previousButton = document.createElement('li');
    previousButton.classList.add('page-item');
    if (currentPage === 1) {
        previousButton.classList.add('disabled');
    } else {
        previousButton.addEventListener('click', () => {
            renderPagination(totalPages, currentPage - 1);
        });
    }
    const previousLink = document.createElement('a');
    previousLink.classList.add('page-link');
    previousLink.href = '#'; // Update the URL as needed
    previousLink.textContent = 'Previous';
    previousButton.appendChild(previousLink);
    pagination.appendChild(previousButton);

    // Page buttons
    for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.classList.add('page-item');
        if (i === currentPage) {
            li.classList.add('active');
        }

        const link = document.createElement('a');
        link.classList.add('page-link');
        link.href = `/categories?page=${i}`; // Update the URL as needed
        link.textContent = i;

        li.appendChild(link);
        pagination.appendChild(li);
    }

    // Next button
    const nextButton = document.createElement('li');
    nextButton.classList.add('page-item');
    if (currentPage === totalPages) {
        nextButton.classList.add('disabled');
    } else {
        nextButton.addEventListener('click', () => {
            renderPagination(totalPages, currentPage + 1);
        });
    }
    const nextLink = document.createElement('a');
    nextLink.classList.add('page-link');
    nextLink.href = '#'; // Update the URL as needed
    nextLink.textContent = 'Next';
    nextButton.appendChild(nextLink);
    pagination.appendChild(nextButton);
    }

    </script>
    
</body>
</html>
