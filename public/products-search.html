<!-- products-search.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Search Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
    <div class="container" style="margin-top: 2em">

        <!-- Search product input -->
        <div class="mb-3">
            <form id="searchForm" action="/products/search" method="get" class="form-inline my-2 my-lg-0">
                <div style="display: flex; justify-content: center;">    
                    <input
                    id="searchedData"
                    class="form-control mr-sm-2 mb-2 mt-2 mx-2"
                    type="search"
                    placeholder="Search Product"
                    aria-label="Search"
                    name="productSearch"
                    />
                    <button
                    class="btn btn-outline-primary my-1 my-sm-2 mx-3"
                    type="submit"
                    >
                    Search
                    </button>
                </div>
            </form>
        </div>
        <!-- End search product input -->

        <div style="display: flex;">
            <div style="flex-grow: 1;"><h3 style="margin-bottom: 1em">Search Results</h3></div>
            <div style="justify-content: flex-end;"><button class="btn btn-primary" onclick="window.location.href='/all-products'" >All Products</button></div>
            <div style="justify-content: flex-end; margin-left: 1em;"><button class="btn btn-primary" onclick="window.location.href='/categories'" >Back to Categories</button></div>
            <div style="justify-content: flex-end; margin-left: 1em;"><button onclick="window.history.back()" class="btn btn-outline-primary"> Back</button></div>
        </div>

        <!-- Display search results -->
        <table border="1" id="products-table" class="table table-striped">
            <thead style="background-color: rgb(58, 58, 58);; color: white">
                <tr>
                    <th scope="col">Product ID</th>
                    <th scope="col">Product Name</th>
                    <th scope="col">Brand</th>
                    <th scope="col">Price</th>
                    <th scope="col">Discounted Price</th>
                    <th scope="col">Created Date</th>
                </tr>
            </thead>
            <tbody id="products-body">
                <!-- Results will be dynamically inserted here -->
            </tbody>
        </table>
        <!-- End display search results -->
    </div>

    <script>
        // Function to fetch data from the endpoint URL
        async function fetchData(url) {
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Function to render products
        async function renderProducts() {
            const searchParams = new URLSearchParams(window.location.search);
            const productSearch = searchParams.get('productSearch');
            const url = `/api/products/search?productSearch=${productSearch}`;
            const { results } = await fetchData(url);
            const tbody = document.getElementById('products-body');
            tbody.innerHTML = '';
            if (results && results.length > 0) {
                results.forEach(product => {
                    const row = `
                        <tr>
                            <td>${product.prod_id}</td>
                            <td>${product.prod_name}</td>
                            <td>${product.prod_brand}</td>
                            <td>${product.price}</td>
                            <td>${product.discounted_price}</td>
                            <td>${product.created_date}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="6">No results found.</td></tr>';
            }
        }

        // Call renderProducts when the page is loaded
        window.onload = renderProducts;
    </script>
</body>
</html>
